import{a as p,b as s}from"./chunk-76M2OJZG.js";import{E as c,I as m}from"./chunk-VKZYAJA6.js";var l="https://api.anthropic.com/v1/messages",A="2023-06-01",d=1e3,h=class a{id="anthropic";name="Anthropic (Claude)";supportsVision=!0;isFree=!1;supportsAudioTranscription=!1;_settings=m(p);async analyzeImage(i,e,n="image/jpeg"){let t=this._settings.getProviderConfig("anthropic"),o=[{type:"image",source:{type:"base64",media_type:n??"image/jpeg",data:i}},{type:"text",text:e}],r=JSON.stringify({model:t.model,max_tokens:d,messages:[{role:"user",content:o}]}),g=await this._fetchWithRetry(t.apiKey,r);return this._extractContent(g)}async complete(i,e){let n=this._settings.getProviderConfig("anthropic"),t={model:n.model,max_tokens:d,messages:[{role:"user",content:i}]};e&&(t.system=e);let o=await this._fetchWithRetry(n.apiKey,JSON.stringify(t));return this._extractContent(o)}async _fetchWithRetry(i,e){if(!i)throw new s("Cl\xE9 API Anthropic manquante",this.id);let n={method:"POST",headers:{"x-api-key":i,"anthropic-version":A,"content-type":"application/json","anthropic-dangerous-direct-browser-access":"true"},body:e},t;try{t=await fetch(l,n)}catch{try{t=await fetch(l,n)}catch{throw new s("Erreur r\xE9seau Anthropic",this.id)}}if(t.status===429)throw new s("Quota Anthropic d\xE9pass\xE9",this.id,!0);if(t.status===401)throw new s("Cl\xE9 API Anthropic invalide",this.id);if(!t.ok)throw new s(`Erreur Anthropic ${t.status}`,this.id);return t}async _extractContent(i){return(await i.json()).content[0].text}static \u0275fac=function(e){return new(e||a)};static \u0275prov=c({token:a,factory:a.\u0275fac})};var w="https://generativelanguage.googleapis.com/v1beta/models",f=class a{id="gemini";name="Google Gemini";supportsVision=!0;isFree=!1;supportsAudioTranscription=!1;_settings=m(p);async analyzeImage(i,e,n="image/jpeg"){let t=this._settings.getProviderConfig("gemini"),r={contents:[{role:"user",parts:[{inline_data:{mime_type:n??"image/jpeg",data:i}},{text:e}]}]};return this._request(t.apiKey,t.model,r)}async complete(i,e){let n=this._settings.getProviderConfig("gemini"),t={contents:[{role:"user",parts:[{text:i}]}]};return e&&(t.system_instruction={parts:[{text:e}]}),this._request(n.apiKey,n.model,t)}async _request(i,e,n){if(!i)throw new s("Cl\xE9 API Gemini manquante",this.id);let t=`${w}/${e}:generateContent?key=${i}`,o={method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(n)},r;try{r=await fetch(t,o)}catch{try{r=await fetch(t,o)}catch{throw new s("Erreur r\xE9seau Gemini",this.id)}}if(r.status===429)throw new s("Quota Gemini d\xE9pass\xE9",this.id,!0);if(r.status===401||r.status===403)throw new s("Cl\xE9 API Gemini invalide",this.id);if(!r.ok)throw new s(`Erreur Gemini ${r.status}`,this.id);return(await r.json()).candidates[0].content.parts[0].text}static \u0275fac=function(e){return new(e||a)};static \u0275prov=c({token:a,factory:a.\u0275fac})};var u=class a{id="ollama";name="Ollama (local)";supportsVision=!0;isFree=!0;supportsAudioTranscription=!1;_settings=m(p);async analyzeImage(i,e,n="image/jpeg"){let t=this._settings.getProviderConfig("ollama"),o={role:"user",content:e,images:[i]};return this._chat(t.baseUrl,t.model,[o])}async complete(i,e){let n=this._settings.getProviderConfig("ollama"),t=[];return e&&t.push({role:"system",content:e}),t.push({role:"user",content:i}),this._chat(n.baseUrl,n.model,t)}async _chat(i,e,n){let t=`${i}/api/chat`,o=JSON.stringify({model:e,messages:n,stream:!1}),r;try{r=await fetch(t,{method:"POST",headers:{"content-type":"application/json"},body:o})}catch{throw new s("Serveur Ollama inaccessible \u2014 v\xE9rifiez que Ollama est d\xE9marr\xE9 localement",this.id)}if(!r.ok)throw new s(`Erreur Ollama ${r.status}`,this.id);return(await r.json()).message.content}static \u0275fac=function(e){return new(e||a)};static \u0275prov=c({token:a,factory:a.\u0275fac})};export{h as a,f as b,u as c};
/**i18n:3b698ac6115e26c70b7214fa13183a3f0b346f16696d658159e28e5dda8d1cfb*/
