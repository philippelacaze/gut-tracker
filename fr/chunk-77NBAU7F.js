import{a as Q}from"./chunk-TTD46CQW.js";import"./chunk-UURK2U23.js";import"./chunk-T2GIJTUG.js";import"./chunk-6MTJZRUS.js";import"./chunk-AW7XRC6X.js";import{a as v}from"./chunk-LRDTLVOK.js";import"./chunk-ODZP3WWA.js";import"./chunk-CJW47YLW.js";import{$a as _,Ab as G,Bb as J,I as y,Ja as R,N as A,O as f,Pa as S,Qa as g,Ra as C,Sa as U,Ta as X,Ua as T,Va as M,Wa as F,Xa as s,Ya as l,Za as K,_ as u,_a as c,ab as j,bb as O,cb as Y,db as V,eb as q,fb as p,gb as L,hb as N,ib as m,qb as B,rb as H,sb as E,tb as b,ub as D,xb as I,za as o}from"./chunk-E5GUXWY3.js";import"./chunk-SX65LPTE.js";var ie=(n,i)=>i.name;function ne(n,i){if(n&1&&(c(0,"span",10),E(1),_()),n&2){let e=m().$implicit;o(),b(e.dose);}}function te(n,i){if(n&1&&(c(0,"li",6)(1,"span",8),E(2),_(),c(3,"span",9),E(4),_(),g(5,ne,2,1,"span",10),_()),n&2){let e=i.$implicit,t=m();o(2),b(e.name),o(),H("medication-card__type--"+e.type),o(),D(" ",t.typeLabel(e.type)," "),o(),C(e.dose?5:-1);}}function oe(n,i){n&1&&(c(0,"li",7),p(1,0),_());}var ae={enzyme:"Enzyme digestive",probiotic:"Probiotique",antibiotic:"Antibiotique",antispasmodic:"Antispasmodique",other:"Autre"},w=class n{entry=J.required();deleted=G();_store=y(v);timeLabel=I(()=>new Date(this.entry().timestamp).toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"}));typeLabel(i){return ae[i];}async onDelete(){try{await this._store.remove(this.entry().id),this.deleted.emit(this.entry().id);}catch(i){console.error("[MedicationEntryCard] Erreur lors de la suppression",i);}}static ɵfac=function(e){return new(e||n)();};static ɵcmp=R({type:n,selectors:[["gt-medication-entry-card"]],inputs:{entry:[1,"entry"]},outputs:{deleted:"deleted"},decls:10,vars:3,consts:()=>{let i;i="Supprimer cette saisie";let e;e="M\xE9dicaments de cette saisie";let t;return t=" Aucun m\xE9dicament renseign\xE9 ",[t,[1,"medication-card"],[1,"medication-card__header"],[1,"medication-card__time"],["type","button","aria-label",i,1,"medication-card__delete-btn",3,"click"],["aria-label",e,1,"medication-card__list"],[1,"medication-card__item"],[1,"medication-card__empty"],[1,"medication-card__name"],[1,"medication-card__type"],[1,"medication-card__dose"]];},template:function(e,t){e&1&&(c(0,"article",1)(1,"header",2)(2,"time",3),E(3),_(),c(4,"button",4),N("click",function(){return t.onDelete();}),E(5," \u2715 "),_()(),c(6,"ul",5),T(7,te,6,5,"li",6,ie,!1,oe,2,0,"li",7),_()()),e&2&&(o(2),S("datetime",t.entry().timestamp),o(),D(" ",t.timeLabel()," "),o(4),M(t.entry().medications));},styles:[".medication-card[_ngcontent-%COMP%]{background:var(--color-surface, #fff);border:1px solid var(--color-border, #e0e0e0);border-radius:12px;padding:16px}.medication-card__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px}.medication-card__time[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-secondary, #666);font-weight:500}.medication-card__delete-btn[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:var(--color-text-muted, #aaa);font-size:1rem;padding:4px 8px;border-radius:4px;line-height:1}.medication-card__delete-btn[_ngcontent-%COMP%]:hover{color:var(--color-danger, #f44336);background:var(--color-danger-light, #fdecea)}.medication-card__list[_ngcontent-%COMP%]{list-style:none;margin:0;padding:0;display:flex;flex-direction:column;gap:8px}.medication-card__item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px;flex-wrap:wrap}.medication-card__name[_ngcontent-%COMP%]{font-weight:600;font-size:.95rem}.medication-card__type[_ngcontent-%COMP%]{font-size:.75rem;padding:2px 8px;border-radius:10px;background:var(--color-surface-alt, #f5f5f5);color:var(--color-text-secondary, #666)}.medication-card__type--enzyme[_ngcontent-%COMP%]{background:#e8f5e9;color:#2e7d32}.medication-card__type--probiotic[_ngcontent-%COMP%]{background:#e3f2fd;color:#1565c0}.medication-card__type--antibiotic[_ngcontent-%COMP%]{background:#fff3e0;color:#e65100}.medication-card__type--antispasmodic[_ngcontent-%COMP%]{background:#f3e5f5;color:#6a1b9a}.medication-card__type--other[_ngcontent-%COMP%]{background:#f5f5f5;color:#555}.medication-card__dose[_ngcontent-%COMP%]{font-size:.8rem;color:var(--color-text-muted, #999)}.medication-card__empty[_ngcontent-%COMP%]{font-size:.875rem;color:var(--color-text-muted, #bbb);font-style:italic}"],changeDetection:0});};var _e=(n,i)=>i.value;function de(n,i){if(n&1){let e=O();c(0,"li",17),N("mousedown",function(a){let d=A(e).$implicit,P=m(2);return f(P.onSuggestionMousedown(a,d));}),E(1),_();}if(n&2){let e=i.$implicit,t=m(2);S("aria-selected",t.name()===e),o(),D(" ",e," ");}}function re(n,i){if(n&1&&(c(0,"ul",8),T(1,de,2,2,"li",16,X),_()),n&2){let e=m();o(),M(e.suggestions());}}function ce(n,i){if(n&1){let e=O();c(0,"button",18),N("click",function(){let a=A(e).$implicit,d=m();return f(d.onTypeSelect(a.value));}),E(1),_();}if(n&2){let e=i.$implicit,t=m();B("medication-picker__type-chip--selected",t.selectedType()===e.value),S("aria-pressed",t.selectedType()===e.value)("aria-label",e.label),o(),D(" ",e.label," ");}}var z=class n{medicationAdded=G();_store=y(v);_name=u("");_selectedType=u("other");_dose=u("");_showSuggestions=u(!1);name=this._name.asReadonly();selectedType=this._selectedType.asReadonly();dose=this._dose.asReadonly();suggestions=I(()=>{let i=this._name().toLowerCase().trim();return i.length<2?[]:this._store.recentMedicationNames().filter(e=>e.toLowerCase().includes(i)).slice(0,8);});showSuggestions=I(()=>this._showSuggestions()&&this.suggestions().length>0);canAdd=I(()=>this._name().trim().length>0);medicationTypes=[{value:"enzyme",label:"Enzyme digestive"},{value:"probiotic",label:"Probiotique"},{value:"antibiotic",label:"Antibiotique"},{value:"antispasmodic",label:"Antispasmodique"},{value:"other",label:"Autre"}];onNameInput(i){this._name.set(i.target.value),this._showSuggestions.set(!0);}onDoseInput(i){this._dose.set(i.target.value);}onNameFocus(){this._showSuggestions.set(!0);}onNameBlur(){this._showSuggestions.set(!1);}onTypeSelect(i){this._selectedType.set(i);}onSuggestionMousedown(i,e){i.preventDefault(),this._name.set(e),this._showSuggestions.set(!1);}addMedication(){let i=this._name().trim();if(!i)return;let e={name:i,type:this._selectedType(),dose:this._dose().trim()||void 0};this.medicationAdded.emit(e),this._name.set(""),this._dose.set(""),this._selectedType.set("other"),this._showSuggestions.set(!1);}static ɵfac=function(e){return new(e||n)();};static ɵcmp=R({type:n,selectors:[["gt-medication-picker"]],outputs:{medicationAdded:"medicationAdded"},decls:18,vars:5,consts:()=>{let i;i="Nom du m\xE9dicament";let e;e="Lactase, Probiotique\u2026";let t;t="Suggestions de m\xE9dicaments";let a;a="Type de m\xE9dicament";let d;d="Dose du m\xE9dicament";let P;P="1 cp, 500 mg\u2026";let x;x="Ajouter ce m\xE9dicament \xE0 la liste";let $;$=" M\xE9dicament ou compl\xE9ment ";let h;h=" Dose "+"\uFFFD#13\uFFFD"+"(optionnel)"+"\uFFFD/#13\uFFFD"+"";let k;return k="Ajouter",[$,h,k,[1,"medication-picker"],[1,"medication-picker__field","medication-picker__field--name"],["for","med-name",1,"medication-picker__label"],[1,"medication-picker__autocomplete"],["id","med-name","type","text","autocomplete","off","aria-autocomplete","list","aria-label",i,"placeholder",e,1,"medication-picker__input",3,"input","focus","blur","value"],["role","listbox","aria-label",t,1,"medication-picker__suggestions"],["role","group","aria-label",a,1,"medication-picker__types"],["type","button",1,"medication-picker__type-chip",3,"medication-picker__type-chip--selected"],[1,"medication-picker__field"],["for","med-dose",1,"medication-picker__label"],[1,"medication-picker__optional"],["id","med-dose","type","text","aria-label",d,"placeholder",P,1,"medication-picker__input","medication-picker__input--dose",3,"input","value"],["type","button","aria-label",x,1,"medication-picker__add-btn",3,"click","disabled"],["role","option",1,"medication-picker__suggestion"],["role","option",1,"medication-picker__suggestion",3,"mousedown"],["type","button",1,"medication-picker__type-chip",3,"click"]];},template:function(e,t){e&1&&(c(0,"div",3)(1,"div",4)(2,"label",5),p(3,0),_(),c(4,"div",6)(5,"input",7),N("input",function(d){return t.onNameInput(d);})("focus",function(){return t.onNameFocus();})("blur",function(){return t.onNameBlur();}),_(),g(6,re,3,0,"ul",8),_()(),c(7,"div",9),T(8,ce,2,5,"button",10,_e),_(),c(10,"div",11)(11,"label",12),V(12,1),j(13,"span",13),q(),_(),c(14,"input",14),N("input",function(d){return t.onDoseInput(d);}),_()(),c(15,"button",15),N("click",function(){return t.addMedication();}),c(16,"span"),p(17,2),_()()()),e&2&&(o(5),Y("value",t.name()),S("aria-expanded",t.showSuggestions()),o(),C(t.showSuggestions()?6:-1),o(2),M(t.medicationTypes),o(6),Y("value",t.dose()),o(),Y("disabled",!t.canAdd()));},styles:[".medication-picker[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.medication-picker__field[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.medication-picker__label[_ngcontent-%COMP%]{font-size:.875rem;font-weight:600;color:var(--color-text-secondary, #555)}.medication-picker__optional[_ngcontent-%COMP%]{font-weight:400;color:var(--color-text-muted, #999)}.medication-picker__autocomplete[_ngcontent-%COMP%]{position:relative}.medication-picker__input[_ngcontent-%COMP%]{width:100%;padding:10px 12px;border:1px solid var(--color-border, #ddd);border-radius:8px;font-size:1rem;background:var(--color-surface, #fff);box-sizing:border-box}.medication-picker__input[_ngcontent-%COMP%]:focus{outline:2px solid var(--color-primary, #1976d2);outline-offset:1px}.medication-picker__input--dose[_ngcontent-%COMP%]{max-width:180px}.medication-picker__suggestions[_ngcontent-%COMP%]{position:absolute;top:calc(100% + 4px);left:0;right:0;background:var(--color-surface, #fff);border:1px solid var(--color-border, #ddd);border-radius:8px;box-shadow:0 4px 12px #0000001a;list-style:none;margin:0;padding:4px 0;z-index:100;max-height:220px;overflow-y:auto}.medication-picker__suggestion[_ngcontent-%COMP%]{padding:10px 14px;cursor:pointer;font-size:.95rem}.medication-picker__suggestion[_ngcontent-%COMP%]:hover, .medication-picker__suggestion[aria-selected=true][_ngcontent-%COMP%]{background:var(--color-primary-light, #e3f2fd)}.medication-picker__types[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:8px}.medication-picker__type-chip[_ngcontent-%COMP%]{padding:6px 14px;border:1px solid var(--color-border, #ddd);border-radius:20px;background:var(--color-surface, #fff);font-size:.85rem;cursor:pointer;transition:background .15s,border-color .15s}.medication-picker__type-chip--selected[_ngcontent-%COMP%]{background:var(--color-primary, #1976d2);border-color:var(--color-primary, #1976d2);color:#fff}.medication-picker__add-btn[_ngcontent-%COMP%]{align-self:flex-start;padding:10px 24px;background:var(--color-primary, #1976d2);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:opacity .15s}.medication-picker__add-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}"],changeDetection:0});};var le=(n,i)=>i.id;function se(n,i){if(n&1&&(s(0,"span",21),E(1),l()),n&2){let e=m().$implicit;o(),b(e.dose);}}function me(n,i){if(n&1){let e=O();s(0,"li",18)(1,"span",20),E(2),l(),g(3,se,2,1,"span",21),s(4,"button",22),L("click",function(){let a=A(e).$index,d=m(2);return f(d.removePendingMedication(a));}),E(5," \u2715 "),l()();}if(n&2){let e=i.$implicit;o(2),b(e.name),o(),C(e.dose?3:-1);}}function Ee(n,i){n&1&&(s(0,"span"),p(1,2),l());}function pe(n,i){n&1&&(s(0,"span"),p(1,3),l());}function ge(n,i){if(n&1){let e=O();s(0,"ul",17),T(1,me,6,2,"li",18,U),l(),s(3,"button",19),L("click",function(){A(e);let a=m();return f(a.saveEntry());}),g(4,Ee,2,0,"span")(5,pe,2,0,"span"),l();}if(n&2){let e=m();o(),M(e.pendingMedications()),o(2),F("disabled",e.saving()),o(),C(e.saving()?4:5);}}function Ce(n,i){n&1&&(s(0,"p",14),p(1,4),l());}function ue(n,i){n&1&&(s(0,"p",15),p(1,5),l());}function Te(n,i){if(n&1&&K(0,"gt-medication-entry-card",23),n&2){let e=i.$implicit;F("entry",e);}}function Me(n,i){if(n&1&&(s(0,"div",16),T(1,Te,1,1,"gt-medication-entry-card",23,le),l()),n&2){let e=m();o(),M(e.todayEntries());}}var ee=class n{_store=y(v);_pendingMedications=u([]);_saving=u(!1);pendingMedications=this._pendingMedications.asReadonly();saving=this._saving.asReadonly();loading=this._store.loading;todayEntries=this._store.todayEntries;canSave=I(()=>this._pendingMedications().length>0);onMedicationAdded(i){this._pendingMedications.update(e=>[...e,i]);}removePendingMedication(i){this._pendingMedications.update(e=>e.filter((t,a)=>a!==i));}onVoiceResult(i){i.data.medications.forEach(t=>this._pendingMedications.update(a=>[...a,{name:t.name,type:t.type,dose:t.dose??void 0}]));}async saveEntry(){if(this.canSave()){this._saving.set(!0);try{let i={id:crypto.randomUUID(),timestamp:new Date().toISOString(),medications:this._pendingMedications()};await this._store.add(i),this._pendingMedications.set([]);}catch(i){console.error("[MedicationEntryPage] Erreur lors de la sauvegarde",i);}finally{this._saving.set(!1);}}}static ɵfac=function(e){return new(e||n)();};static ɵcmp=R({type:n,selectors:[["gt-medication-entry-page"]],decls:14,vars:3,consts:()=>{let i;i="Nouvelle saisie m\xE9dicament";let e;e="Journal des m\xE9dicaments du jour";let t;t=" M\xE9dicaments & compl\xE9ments ";let a;a=" Aujourd'hui ";let d;d="M\xE9dicaments \xE0 enregistrer";let P;P="Retirer ce m\xE9dicament";let x;x="Enregistrement\u2026";let $;$="Enregistrer la saisie";let h;h=" Chargement\u2026 ";let k;return k=" Aucune saisie aujourd'hui. ",[t,a,x,$,h,k,[1,"medication-entry-page"],[1,"medication-entry-page__header"],[1,"medication-entry-page__title"],["aria-label",i,1,"medication-entry-page__form"],[3,"medicationAdded"],[3,"parseResultReady","context"],["aria-label",e,1,"medication-entry-page__journal"],[1,"medication-entry-page__journal-title"],[1,"medication-entry-page__loading"],[1,"medication-entry-page__empty"],[1,"medication-entry-page__entries"],["aria-label",d,1,"medication-entry-page__pending"],[1,"medication-entry-page__pending-item"],["type","button",1,"medication-entry-page__save-btn",3,"click","disabled"],[1,"medication-entry-page__pending-name"],[1,"medication-entry-page__pending-dose"],["type","button","aria-label",P,1,"medication-entry-page__pending-remove",3,"click"],[3,"entry"]];},template:function(e,t){e&1&&(s(0,"main",6)(1,"header",7)(2,"h1",8),p(3,0),l()(),s(4,"section",9)(5,"gt-medication-picker",10),L("medicationAdded",function(d){return t.onMedicationAdded(d);}),l(),g(6,ge,6,2),l(),s(7,"gt-voice-input",11),L("parseResultReady",function(d){return t.onVoiceResult(d);}),l(),s(8,"section",12)(9,"h2",13),p(10,1),l(),g(11,Ce,2,0,"p",14)(12,ue,2,0,"p",15)(13,Me,3,0,"div",16),l()()),e&2&&(o(6),C(t.pendingMedications().length>0?6:-1),o(),F("context","medication"),o(4),C(t.loading()?11:t.todayEntries().length===0?12:13));},dependencies:[z,w,Q],styles:[".medication-entry-page[_ngcontent-%COMP%]{padding:16px;max-width:640px;margin:0 auto;display:flex;flex-direction:column;gap:32px}.medication-entry-page__header[_ngcontent-%COMP%]{padding-bottom:8px;border-bottom:1px solid var(--color-border, #e0e0e0)}.medication-entry-page__title[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;margin:0}.medication-entry-page__form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:20px}.medication-entry-page__pending[_ngcontent-%COMP%]{list-style:none;margin:0;padding:12px;background:var(--color-surface-alt, #f9f9f9);border-radius:10px;display:flex;flex-direction:column;gap:8px}.medication-entry-page__pending-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.medication-entry-page__pending-name[_ngcontent-%COMP%]{font-weight:600;flex:1}.medication-entry-page__pending-dose[_ngcontent-%COMP%]{font-size:.85rem;color:var(--color-text-muted, #999)}.medication-entry-page__pending-remove[_ngcontent-%COMP%]{background:none;border:none;cursor:pointer;color:var(--color-text-muted, #aaa);font-size:.9rem;padding:2px 6px;border-radius:4px}.medication-entry-page__pending-remove[_ngcontent-%COMP%]:hover{color:var(--color-danger, #f44336)}.medication-entry-page__save-btn[_ngcontent-%COMP%]{align-self:flex-start;padding:12px 28px;background:var(--color-primary, #1976d2);color:#fff;border:none;border-radius:8px;font-size:1rem;font-weight:600;cursor:pointer;transition:opacity .15s}.medication-entry-page__save-btn[_ngcontent-%COMP%]:disabled{opacity:.4;cursor:not-allowed}.medication-entry-page__journal[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.medication-entry-page__journal-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin:0}.medication-entry-page__loading[_ngcontent-%COMP%], .medication-entry-page__empty[_ngcontent-%COMP%]{color:var(--color-text-muted, #999);font-style:italic;font-size:.9rem}.medication-entry-page__entries[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}"],changeDetection:0});};export{ee as MedicationEntryPageComponent};/**i18n:458ef2e3e7a64b5532930a6ba4400e2455e83eabba967f093a6335516d2bc053*/