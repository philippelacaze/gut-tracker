import{b as a,c as b}from"./chunk-EJBXVPCY.js";import{E as g,I as S,S as R,_ as v}from"./chunk-IDFEJ3YL.js";import{a as f}from"./chunk-PC5BUYN6.js";var P=5e3,T=3e4,w=class i{_document=S(R);_openAi=S(b,{optional:!0});isWebSpeechSupported;constructor(){let e=this._document.defaultView;this.isWebSpeechSupported=!!(e?.SpeechRecognition??e?.webkitSpeechRecognition)}startRecording(e,t){return t==="whisper"?this._startWhisper(e):this._startWebSpeech(e)}_startWebSpeech(e){let t=this._document.defaultView,n=t?.SpeechRecognition??t?.webkitSpeechRecognition;if(!n)throw new a("Web Speech API non support\xE9e par ce navigateur","voice");let r=new n;r.continuous=!0,r.interimResults=!0,r.lang=e;let c,p="",o=0;return{result:new Promise((s,E)=>{let m=setTimeout(()=>r.stop(),T);r.onresult=u=>{clearTimeout(c);for(let d=o;d<u.results.length;d++)u.results[d].isFinal&&(p+=u.results[d][0].transcript,o=d+1);c=setTimeout(()=>r.stop(),P)},r.onend=()=>{clearTimeout(m),clearTimeout(c),s(p.trim())},r.onerror=u=>{clearTimeout(m),clearTimeout(c),E(new a(`Erreur reconnaissance vocale : ${u.error}`,"voice"))},r.start()}),stop:()=>r.stop()}}_startWhisper(e){let t=[],n=null;return{result:new Promise(async(c,p)=>{try{let o=await navigator.mediaDevices.getUserMedia({audio:!0});n=new MediaRecorder(o),n.ondataavailable=l=>{l.data.size>0&&t.push(l.data)},n.onstop=async()=>{o.getTracks().forEach(s=>s.stop());let l=new Blob(t,{type:"audio/webm"});try{if(!this._openAi?.transcribeAudio)throw new a("Transcription Whisper non disponible \u2014 configurez OpenAI","voice");let s=await this._openAi.transcribeAudio(l,e);c(s)}catch(s){p(s)}},n.start()}catch(o){p(o instanceof Error?new a(`Microphone inaccessible : ${o.message}`,"voice"):new a("Microphone inaccessible","voice"))}}),stop:()=>{n?.state==="recording"&&n.stop()}}}static \u0275fac=function(t){return new(t||i)};static \u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"})};var h={bodyMapGender:"male",language:"fr",voiceInputEnabled:!1,voiceSttProvider:"webSpeechApi"};var y="gt_user_preferences",I=class i{_preferences=v(this._load());preferences=this._preferences.asReadonly();_load(){try{let e=localStorage.getItem(y);return e?f(f({},structuredClone(h)),JSON.parse(e)):structuredClone(h)}catch{return structuredClone(h)}}save(e){localStorage.setItem(y,JSON.stringify(e)),this._preferences.set(e)}static \u0275fac=function(t){return new(t||i)};static \u0275prov=g({token:i,factory:i.\u0275fac,providedIn:"root"})};export{w as a,I as b};
/**i18n:918d96059ed66fbebb60f4bd87db3c1942466580e5a9c1fc52acfb8dfe04d50e*/
