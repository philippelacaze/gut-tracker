import{a as k}from"./chunk-PR42RNLE.js";import{a as z,b as G}from"./chunk-YILZDDCD.js";import{$a as _,Ab as b,Bb as U,E as A,I as u,Ja as F,N as c,O as l,P as y,Pa as h,Qa as g,Ra as m,_ as f,_a as r,ab as v,bb as E,cb as $,db as P,eb as I,fb as d,hb as p,ib as a,qb as D,sb as L,ub as w,xb as N,za as C}from"./chunk-VKZYAJA6.js";import{a as T}from"./chunk-5NTB5CRB.js";var j={mealType:null,foods:[],notes:null},B={symptoms:[]},J={medications:[]},O=class n{_aiService=u(k);async parse(t,e){let i=await this._aiService.parseVoiceTranscript(t,e),o=this._parseJson(i,e);return{context:e,transcript:t,data:o};}_parseJson(t,e){try{let i=t.match(/\{[\s\S]*\}/);return i?JSON.parse(i[0]):this._fallback(e);}catch{return this._fallback(e);}}_fallback(t){return t==="food"?T({},j):t==="symptom"?T({},B):T({},J);}static ɵfac=function(e){return new(e||n)();};static ɵprov=A({token:n,factory:n.ɵfac,providedIn:"root"});};function K(n,t){if(n&1){let e=E();r(0,"button",10),p("click",function(){c(e);let o=a(2);return l(o.onFabClick());}),y(),r(1,"svg",11),v(2,"path",12),_()();}if(n&2){let e=a(2);D("voice-input__fab--recording",e.voiceState()==="recording"),h("aria-pressed",e.voiceState()==="recording")("aria-label",e.fabAriaLabel());}}function Y(n,t){if(n&1){let e=E();r(0,"p",13),P(1,0),v(2,"span",14),I(),_(),r(3,"button",15),p("click",function(){c(e);let o=a(3);return l(o.onFabClick());}),d(4,1),_();}}function q(n,t){n&1&&(r(0,"p",13),P(1,2),v(2,"span",16),I(),_());}function Q(n,t){if(n&1){let e=E();r(0,"label",17),d(1,3),_(),r(2,"textarea",18),p("input",function(o){c(e);let S=a(3);return l(S.onTranscriptChange(o));}),_(),r(3,"div",19)(4,"button",20),p("click",function(){c(e);let o=a(3);return l(o.analyse());}),d(5,4),_(),r(6,"button",15),p("click",function(){c(e);let o=a(3);return l(o.cancel());}),d(7,5),_()();}if(n&2){let e=a(3);C(2),$("value",e.transcript());}}function W(n,t){n&1&&(r(0,"p",13),P(1,6),v(2,"span",16),I(),_());}function Z(n,t){if(n&1){let e=E();r(0,"p",21),L(1),_(),r(2,"button",15),p("click",function(){c(e);let o=a(3);return l(o.cancel());}),d(3,7),_();}if(n&2){let e=a(3);C(),w(" ",e.errorMessage()," ");}}function ee(n,t){if(n&1&&(r(0,"div",9),g(1,Y,5,0)(2,q,3,0,"p",13)(3,Q,8,1)(4,W,3,0,"p",13)(5,Z,4,1),_()),n&2){let e,i=a(2);C(),m((e=i.voiceState())==="recording"?1:e==="transcribing"?2:e==="done"?3:e==="parsing"?4:e==="error"?5:-1);}}function te(n,t){if(n&1&&(g(0,K,3,4,"button",8),g(1,ee,6,1,"div",9)),n&2){let e=a();m(e.voiceState()!=="parsing"?0:-1),C(),m(e.voiceState()!=="idle"?1:-1);}}var ne=3e3,H=class n{context=U.required();parseResultReady=b();cancelled=b();_userPrefsService=u(G);_voiceRecService=u(z);_parserService=u(O);_voiceState=f("idle");_transcript=f("");_errorMessage=f("");_session=null;_errorTimer;voiceState=this._voiceState.asReadonly();transcript=this._transcript.asReadonly();errorMessage=this._errorMessage.asReadonly();isVoiceEnabled=N(()=>this._userPrefsService.preferences().voiceInputEnabled);fabAriaLabel=N(()=>{switch(this._voiceState()){case"recording":return"Arr\xEAter l'enregistrement";case"transcribing":return"Transcription en cours\u2026";case"parsing":return"Analyse en cours\u2026";default:return"D\xE9marrer la saisie vocale";}});ngOnDestroy(){clearTimeout(this._errorTimer),this._session?.stop();}onFabClick(){let t=this._voiceState();t==="idle"?this._startRecording():t==="recording"&&this._stopRecording();}onTranscriptChange(t){this._transcript.set(t.target.value);}async analyse(){this._voiceState.set("parsing");try{let t=await this._parserService.parse(this._transcript(),this.context());this.parseResultReady.emit(t),this._reset();}catch{this._setError("Erreur lors de l'analyse. R\xE9essayez.");}}cancel(){this._session?.stop(),this._session=null,this._reset(),this.cancelled.emit();}_startRecording(){let t=this._userPrefsService.preferences(),e=t.language==="fr"?"fr-FR":"en-US";try{this._session=this._voiceRecService.startRecording(e,t.voiceSttProvider),this._voiceState.set("recording"),this._session.result.then(i=>{this._transcript.set(i),this._voiceState.set("done");}).catch(i=>{console.error("Error parsing transcript",i),this._setError("Erreur de reconnaissance vocale.");});}catch{this._setError("Saisie vocale non disponible sur ce navigateur.");}}_stopRecording(){this._voiceState.set("transcribing"),this._session?.stop(),this._session=null;}_reset(){this._voiceState.set("idle"),this._transcript.set(""),this._errorMessage.set("");}_setError(t){this._errorMessage.set(t),this._voiceState.set("error"),this._errorTimer=setTimeout(()=>this._reset(),ne);}static ɵfac=function(e){return new(e||n)();};static ɵcmp=F({type:n,selectors:[["gt-voice-input"]],inputs:{context:[1,"context"]},outputs:{parseResultReady:"parseResultReady",cancelled:"cancelled"},decls:1,vars:1,consts:()=>{let t;t="Saisie vocale";let e;e=""+"\uFFFD#2\uFFFD"+"\u23FA"+"\uFFFD/#2\uFFFD"+" \xC9coute en cours\u2026 ";let i;i=" Arr\xEAter ";let o;o=""+"\uFFFD#2\uFFFD"+"\u27F3"+"\uFFFD/#2\uFFFD"+" Transcription\u2026 ";let S;S=" V\xE9rifiez et modifiez si besoin : ";let M;M=" Analyser ";let x;x=" Annuler ";let V;V=""+"\uFFFD#2\uFFFD"+"\u27F3"+"\uFFFD/#2\uFFFD"+" Analyse IA en cours\u2026 ";let R;return R=" Fermer ",[e,i,o,S,M,x,V,R,["type","button",1,"voice-input__fab",3,"voice-input__fab--recording"],["role","dialog","aria-modal","false","aria-live","polite","aria-label",t,1,"voice-input__overlay"],["type","button",1,"voice-input__fab",3,"click"],["aria-hidden","true","xmlns","http://www.w3.org/2000/svg","viewBox","0 0 24 24","fill","currentColor","width","24","height","24"],["d","M12 14a3 3 0 0 0 3-3V5a3 3 0 0 0-6 0v6a3 3 0 0 0 3 3zm5-3a5 5 0 0 1-10 0H5a7 7 0 0 0 6 6.93V20H9v2h6v-2h-2v-2.07A7 7 0 0 0 19 11h-2z"],[1,"voice-input__status"],["aria-hidden","true",1,"voice-input__spinner"],["type","button",1,"voice-input__btn","voice-input__btn--secondary",3,"click"],["aria-hidden","true",1,"voice-input__spinner","voice-input__spinner--spin"],["for","voice-transcript",1,"voice-input__label"],["id","voice-transcript","rows","3",1,"voice-input__textarea",3,"input","value"],[1,"voice-input__actions"],["type","button",1,"voice-input__btn","voice-input__btn--primary",3,"click"],["role","alert",1,"voice-input__error"]];},template:function(e,i){e&1&&g(0,te,2,2),e&2&&m(i.isVoiceEnabled()?0:-1);},styles:[".voice-input__fab[_ngcontent-%COMP%]{position:fixed;bottom:76px;right:24px;z-index:110;display:flex;align-items:center;justify-content:center;width:56px;height:56px;border-radius:50%;border:none;cursor:pointer;background:#2e7d32;color:#fff;box-shadow:0 2px 8px #0000001f;transition:background .2s}.voice-input__fab[_ngcontent-%COMP%]:hover{background:#43a047}.voice-input__fab[_ngcontent-%COMP%]:focus-visible:focus-visible{outline:2px solid #2e7d32;outline-offset:2px}.voice-input__fab--recording[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_voice-pulse 1.2s ease-in-out infinite}@media(min-width:768px){.voice-input__fab[_ngcontent-%COMP%]{bottom:24px}}.voice-input__overlay[_ngcontent-%COMP%]{position:fixed;bottom:140px;right:16px;width:min(360px,100vw - 32px);z-index:110;background:#fff;border-radius:8px;box-shadow:0 8px 24px #0000002e;padding:16px;display:flex;flex-direction:column;gap:12px}@media(min-width:768px){.voice-input__overlay[_ngcontent-%COMP%]{bottom:88px}}.voice-input__status[_ngcontent-%COMP%]{margin:0;display:flex;align-items:center;gap:8px;color:#1a1a1a;font-size:.95rem}.voice-input__spinner[_ngcontent-%COMP%]{display:inline-block;color:#2e7d32}.voice-input__spinner--spin[_ngcontent-%COMP%]{animation:_ngcontent-%COMP%_spin 1s linear infinite}.voice-input__label[_ngcontent-%COMP%]{font-size:.875rem;color:#757575}.voice-input__textarea[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;padding:8px;border:1px solid #e0e0e0;border-radius:4px;font-size:.95rem;resize:vertical;color:#1a1a1a;background:#f4f6f4}.voice-input__textarea[_ngcontent-%COMP%]:focus{outline:none;border-color:#2e7d32}.voice-input__error[_ngcontent-%COMP%]{margin:0;color:#d32f2f;font-size:.9rem}.voice-input__actions[_ngcontent-%COMP%]{display:flex;gap:8px;justify-content:flex-end}.voice-input__btn[_ngcontent-%COMP%]{padding:8px 16px;border-radius:4px;border:none;cursor:pointer;font-size:.9rem;font-weight:500}.voice-input__btn--primary[_ngcontent-%COMP%]{background:#2e7d32;color:#fff}.voice-input__btn--primary[_ngcontent-%COMP%]:hover{background:#43a047}.voice-input__btn--secondary[_ngcontent-%COMP%]{background:transparent;color:#2e7d32;border:1px solid #2e7d32}.voice-input__btn--secondary[_ngcontent-%COMP%]:hover{background:#e8f5e9}.voice-input__btn[_ngcontent-%COMP%]:focus-visible:focus-visible{outline:2px solid #2e7d32;outline-offset:2px}@keyframes _ngcontent-%COMP%_voice-pulse{0%,to{box-shadow:0 0 #2e7d3266}50%{box-shadow:0 0 0 12px #2e7d3200}}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}"],changeDetection:0});};export{H as a};/**i18n:3b698ac6115e26c70b7214fa13183a3f0b346f16696d658159e28e5dda8d1cfb*/