import{b as p,c as w}from"./chunk-PY5CWWVX.js";import{E as g,I as S,S as v,_ as b}from"./chunk-GWGL4R4C.js";import{a as h}from"./chunk-5NWPNMTQ.js";var P=5e3,T=3e4,y=class n{_document=S(v);_openAi=S(w,{optional:!0});isWebSpeechSupported;constructor(){let e=this._document.defaultView;this.isWebSpeechSupported=!!(e?.SpeechRecognition??e?.webkitSpeechRecognition)}startRecording(e,t){return t==="whisper"?this._startWhisper(e):this._startWebSpeech(e)}_startWebSpeech(e){let t=this._document.defaultView,o=t?.SpeechRecognition??t?.webkitSpeechRecognition;if(!o)throw new p("Web Speech API non support\xE9e par ce navigateur","voice");let r=new o;r.continuous=!1,r.interimResults=!0,r.lang=e;let s,l="";return{result:new Promise((a,i)=>{let m=setTimeout(()=>r.stop(),T);r.onresult=u=>{clearTimeout(s);let R="";for(let d=0;d<u.results.length;d++)u.results[d].isFinal&&(R+=u.results[d][0].transcript);l=R,s=setTimeout(()=>r.stop(),P)},r.onend=()=>{clearTimeout(m),clearTimeout(s),a(l.trim())},r.onerror=u=>{clearTimeout(m),clearTimeout(s),i(new p(`Erreur reconnaissance vocale : ${u.error}`,"voice"))},r.start()}),stop:()=>r.stop()}}_startWhisper(e){let t=[],o=null;return{result:new Promise(async(s,l)=>{try{let c=await navigator.mediaDevices.getUserMedia({audio:!0});o=new MediaRecorder(c),o.ondataavailable=a=>{a.data.size>0&&t.push(a.data)},o.onstop=async()=>{c.getTracks().forEach(i=>i.stop());let a=new Blob(t,{type:"audio/webm"});try{if(!this._openAi?.transcribeAudio)throw new p("Transcription Whisper non disponible \u2014 configurez OpenAI","voice");let i=await this._openAi.transcribeAudio(a,e);s(i)}catch(i){l(i)}},o.start()}catch(c){l(c instanceof Error?new p(`Microphone inaccessible : ${c.message}`,"voice"):new p("Microphone inaccessible","voice"))}}),stop:()=>{o?.state==="recording"&&o.stop()}}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};var f={bodyMapGender:"male",language:"fr",voiceInputEnabled:!1,voiceSttProvider:"webSpeechApi"};var I="gt_user_preferences",E=class n{_preferences=b(this._load());preferences=this._preferences.asReadonly();_load(){try{let e=localStorage.getItem(I);return e?h(h({},structuredClone(f)),JSON.parse(e)):structuredClone(f)}catch{return structuredClone(f)}}save(e){localStorage.setItem(I,JSON.stringify(e)),this._preferences.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};export{y as a,E as b};
/**i18n:185be897c39810308387c12f12d03cfc55693f2502a2b367905371172c1f632a*/
