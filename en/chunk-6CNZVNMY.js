import{b as l,c as b}from"./chunk-EJBXVPCY.js";import{E as g,I as S,S as R,_ as v}from"./chunk-IDFEJ3YL.js";import{a as f}from"./chunk-PC5BUYN6.js";var _=5e3,P=3e4,w=class n{_document=S(R);_openAi=S(b,{optional:!0});isWebSpeechSupported;constructor(){let e=this._document.defaultView;this.isWebSpeechSupported=!!(e?.SpeechRecognition??e?.webkitSpeechRecognition)}startRecording(e,t){return t==="whisper"?this._startWhisper(e):this._startWebSpeech(e)}_startWebSpeech(e){let t=this._document.defaultView,o=t?.SpeechRecognition??t?.webkitSpeechRecognition;if(!o)throw new l("Web Speech API non support\xE9e par ce navigateur","voice");let r=new o;r.continuous=!0,r.interimResults=!0,r.lang=e;let s,u="";return{result:new Promise((a,i)=>{let m=setTimeout(()=>r.stop(),P);r.onresult=p=>{clearTimeout(s);for(let d=p.resultIndex;d<p.results.length;d++)p.results[d].isFinal&&(u+=p.results[d][0].transcript);s=setTimeout(()=>r.stop(),_)},r.onend=()=>{clearTimeout(m),clearTimeout(s),a(u.trim())},r.onerror=p=>{clearTimeout(m),clearTimeout(s),i(new l(`Erreur reconnaissance vocale : ${p.error}`,"voice"))},r.start()}),stop:()=>r.stop()}}_startWhisper(e){let t=[],o=null;return{result:new Promise(async(s,u)=>{try{let c=await navigator.mediaDevices.getUserMedia({audio:!0});o=new MediaRecorder(c),o.ondataavailable=a=>{a.data.size>0&&t.push(a.data)},o.onstop=async()=>{c.getTracks().forEach(i=>i.stop());let a=new Blob(t,{type:"audio/webm"});try{if(!this._openAi?.transcribeAudio)throw new l("Transcription Whisper non disponible \u2014 configurez OpenAI","voice");let i=await this._openAi.transcribeAudio(a,e);s(i)}catch(i){u(i)}},o.start()}catch(c){u(c instanceof Error?new l(`Microphone inaccessible : ${c.message}`,"voice"):new l("Microphone inaccessible","voice"))}}),stop:()=>{o?.state==="recording"&&o.stop()}}}static \u0275fac=function(t){return new(t||n)};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};var h={bodyMapGender:"male",language:"fr",voiceInputEnabled:!1,voiceSttProvider:"webSpeechApi"};var y="gt_user_preferences",I=class n{_preferences=v(this._load());preferences=this._preferences.asReadonly();_load(){try{let e=localStorage.getItem(y);return e?f(f({},structuredClone(h)),JSON.parse(e)):structuredClone(h)}catch{return structuredClone(h)}}save(e){localStorage.setItem(y,JSON.stringify(e)),this._preferences.set(e)}static \u0275fac=function(t){return new(t||n)};static \u0275prov=g({token:n,factory:n.\u0275fac,providedIn:"root"})};export{w as a,I as b};
/**i18n:918d96059ed66fbebb60f4bd87db3c1942466580e5a9c1fc52acfb8dfe04d50e*/
