import{E as p,I as g,_ as l}from"./chunk-IDFEJ3YL.js";var d={selectedProvider:"openai",providers:{openai:{apiKey:"",model:"gpt-4o"},anthropic:{apiKey:"",model:"claude-opus-4-6"},gemini:{apiKey:"",model:"gemini-1.5-pro"},ollama:{baseUrl:"http://localhost:11434",model:"llava"}}};var m="gt_ai_settings",c=class n{_settings=l(this._load());settings=this._settings.asReadonly();_load(){try{let e=localStorage.getItem(m);return e?JSON.parse(atob(e)):structuredClone(d)}catch{return structuredClone(d)}}save(e){localStorage.setItem(m,btoa(JSON.stringify(e))),this._settings.set(e)}getProviderConfig(e){return this._settings().providers[e]}getSelectedProvider(){return this._settings().selectedProvider}static \u0275fac=function(i){return new(i||n)};static \u0275prov=p({token:n,factory:n.\u0275fac,providedIn:"root"})};var s=class extends Error{constructor(i,r,t=!1){super(i);this.provider=r;this.isQuotaError=t;this.name="AiError"}};var h="https://api.openai.com/v1/chat/completions",y="https://api.openai.com/v1/audio/transcriptions",u=class n{id="openai";name="OpenAI";supportsVision=!0;isFree=!1;supportsAudioTranscription=!0;_settings=g(c);async analyzeImage(e,i,r="image/jpeg"){let t=this._settings.getProviderConfig("openai"),o=JSON.stringify({model:t.model,messages:[{role:"user",content:[{type:"image_url",image_url:{url:`data:${r??"image/jpeg"};base64,${e}`}},{type:"text",text:i}]}],max_tokens:1e3}),a=await this._fetchWithRetry(t.apiKey,o);return this._extractContent(a)}async complete(e,i){let r=this._settings.getProviderConfig("openai"),t=[];i&&t.push({role:"system",content:i}),t.push({role:"user",content:e});let o=JSON.stringify({model:r.model,messages:t,max_tokens:1e3}),a=await this._fetchWithRetry(r.apiKey,o);return this._extractContent(a)}async transcribeAudio(e,i){let r=this._settings.getProviderConfig("openai");if(!r.apiKey)throw new s("Cl\xE9 API OpenAI manquante",this.id);let t=new FormData;t.append("file",e,"audio.webm"),t.append("model","whisper-1"),t.append("language",i.split("-")[0]);let o;try{o=await fetch(y,{method:"POST",headers:{Authorization:`Bearer ${r.apiKey}`},body:t})}catch{throw new s("Erreur r\xE9seau Whisper",this.id)}if(!o.ok)throw new s(`Erreur Whisper ${o.status}`,this.id);return(await o.json()).text}async _fetchWithRetry(e,i){if(!e)throw new s("Cl\xE9 API OpenAI manquante",this.id);let r={method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:i},t;try{t=await fetch(h,r)}catch{try{t=await fetch(h,r)}catch{throw new s("Erreur r\xE9seau OpenAI",this.id)}}if(t.status===429)throw new s("Quota OpenAI d\xE9pass\xE9",this.id,!0);if(t.status===401)throw new s("Cl\xE9 API OpenAI invalide",this.id);if(!t.ok)throw new s(`Erreur OpenAI ${t.status}`,this.id);return t}async _extractContent(e){return(await e.json()).choices[0].message.content}static \u0275fac=function(i){return new(i||n)};static \u0275prov=p({token:n,factory:n.\u0275fac})};export{c as a,s as b,u as c};
/**i18n:918d96059ed66fbebb60f4bd87db3c1942466580e5a9c1fc52acfb8dfe04d50e*/
